# TypeORM Transactional Tests

## Overview

TypeORM Transactional Tests wraps every Jest spec in an isolated database transaction. The helper accepts any initialized `DataSource`, replaces its manager during the spec, and restores the original manager after a rollback. The package targets reusable test setups that keep integration databases pristine.

## Features

- Transaction lifecycle helper with explicit `init` and `finish` hooks.
- Compatibility with MySQL, MariaDB, PostgreSQL, SQLite, and Better SQLite 3.
- Deterministic data factories driven by a reproducible execution seed.
- Shared test setup that initializes one data source per worker and runs specs in parallel.
- Coverage reports generated by default through `pnpm test`.
- Build artifacts produced by `pnpm build` and consumed by the Jest suite to simulate an installed package.

## Installation

```bash
pnpm add typeorm-transactional-tests
pnpm add typeorm # peer dependency example
```

Install TypeORM in the host project if it is not already available.

## Usage

Create a Jest setup file that initializes the data source and registers the transactional lifecycle.

```typescript
import { DataSource } from 'typeorm';
import { createTransactionalTestContext } from 'typeorm-transactional-tests';

const dataSource = new DataSource({
  type: 'mysql',
  host: '127.0.0.1',
  port: 3306,
  username: 'root',
  password: 'test',
  database: 'test',
  synchronize: true,
  entities: [/* entities */]
});

const transactionalContext = createTransactionalTestContext(dataSource);

beforeAll(async () => {
  await dataSource.initialize();
});

afterAll(async () => {
  await dataSource.destroy();
});

beforeEach(async () => {
  await transactionalContext.init();
});

afterEach(async () => {
  await transactionalContext.finish();
});
```

Import `createTransactionalTestContext` in your specs and run your assertions against repositories or the entity manager. Every mutation executed between `init` and `finish` is rolled back automatically.

## Test Execution

The suite seeds reproducible fixtures per spec and exposes the `TEST_SEED` environment variable to control execution order. `pnpm test` runs Jest in parallel workers, enforces coverage collection, and builds the package beforehand so the compiled output is exercised.

## Continuous Integration

The GitHub Actions workflow lints the source code and runs the Jest suite against a matrix of transactional databases. A final aggregation job fails when any matrix job reports an error, which keeps the required status check stable even as new databases are added.

## Development

- `pnpm lint` checks code quality.
- `pnpm build` emits the production bundle under `dist`.
- `pnpm test` rebuilds the package, executes the seeded integration tests, and verifies the tarball can be installed in a clean project.

## License

TypeORM Transactional Tests is available under the GNU General Public License v3.0 or later.
